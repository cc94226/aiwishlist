import{c as h,a as u,b as c,w as l,d as L,e as I,F as _,t as N,r as S,o as p,f as m,g as W,h as D,i as E}from"./vue-vendor-CyCdHuvd.js";import{l as a}from"./utils-BSVtTUhg.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();function b(){const e=localStorage.getItem("users");return e?JSON.parse(e):[]}function A(e){localStorage.setItem("users",JSON.stringify(e))}function d(){const e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}function U(e){localStorage.setItem("currentUser",JSON.stringify(e))}function k(){localStorage.removeItem("currentUser")}function Q(e,t){const o=b().find(r=>r.email===e&&r.password===t);if(o){const{password:r,...n}=o;return U(n),{success:!0,user:n,message:"登录成功"}}return{success:!1,message:"邮箱或密码错误"}}function X(e,t,s,o){const r=b();if(r.some(g=>g.email===t))return{success:!1,message:"该邮箱已被注册",errors:["邮箱已存在"]};const n={id:`user-${Date.now()}`,name:e,email:t,password:s,role:"user",job:o||"",createdAt:new Date().toISOString()};r.push(n),A(r);const{password:i,...f}=n;return U(f),{success:!0,user:f,message:"注册成功"}}function y(){const e=d();return e&&e.role==="admin"}function O(e){const t=d();return t?e.submitter===t.name||e.submitterId===t.id:!1}function Y(e){return y()?!0:O(e)&&e.status==="draft"}function Z(e){return y()?!0:O(e)&&e.status==="draft"}function q(){const e=b();if(!e.some(s=>s.email==="admin@example.com")){const s={id:"admin-001",name:"系统管理员",role:"admin",email:"admin@example.com",password:"admin123",job:"开发",createdAt:new Date().toISOString()};e.push(s),A(e)}if(!d()){const s=e.find(o=>o.email==="admin@example.com");if(s){const{password:o,...r}=s;U(r)}}}const x=(e,t)=>{const s=e.__vccOpts||e;for(const[o,r]of t)s[o]=r;return s},C={name:"App",data(){return{currentUser:null}},mounted(){this.loadUser(),this.$watch(()=>this.$route.path,()=>{this.loadUser()})},methods:{loadUser(){this.currentUser=d()},handleLogout(){k(),this.currentUser=null,this.$router.push("/")}}},H={id:"app"},V={class:"navbar"},B={class:"container"},J={class:"nav-links"},F={class:"user-name"},R={class:"main-content"};function $(e,t,s,o,r,n){const i=S("router-link"),f=S("router-view");return p(),h("div",H,[u("nav",V,[u("div",B,[t[8]||(t[8]=u("h1",{class:"logo"},"AI工具需求愿望收集平台",-1)),u("div",J,[c(i,{to:"/"},{default:l(()=>[...t[1]||(t[1]=[m("首页",-1)])]),_:1}),c(i,{to:"/submit"},{default:l(()=>[...t[2]||(t[2]=[m("提交愿望",-1)])]),_:1}),r.currentUser?(p(),L(i,{key:0,to:"/admin"},{default:l(()=>[...t[3]||(t[3]=[m("管理面板",-1)])]),_:1})):I("",!0),r.currentUser?(p(),h(_,{key:1},[c(i,{to:"/dashboard"},{default:l(()=>[...t[4]||(t[4]=[m("仪表板",-1)])]),_:1}),c(i,{to:"/profile"},{default:l(()=>[...t[5]||(t[5]=[m("用户信息",-1)])]),_:1}),u("span",F,N(r.currentUser.name),1),u("button",{class:"btn-logout-nav",onClick:t[0]||(t[0]=(...g)=>n.handleLogout&&n.handleLogout(...g))},"退出")],64)):(p(),h(_,{key:2},[c(i,{to:"/login"},{default:l(()=>[...t[6]||(t[6]=[m("登录",-1)])]),_:1}),c(i,{to:"/register"},{default:l(()=>[...t[7]||(t[7]=[m("注册",-1)])]),_:1})],64))])])]),u("main",R,[c(f)])])}const j=x(C,[["render",$]]);function w(e,t,s){d()?s():s({name:"Login",query:{redirect:e.fullPath}})}function z(e,t,s){if(!d()){s({name:"Login",query:{redirect:e.fullPath}});return}y()?s():s({name:"Home",query:{error:"unauthorized"}})}function v(e,t,s){d()?s({name:"Home"}):s()}const K=[{path:"/",name:"Home",component:a("Home")},{path:"/submit",name:"SubmitWish",component:a("SubmitWish")},{path:"/wish/:id",name:"WishDetail",component:a("WishDetail")},{path:"/admin",name:"AdminPanel",component:a("AdminPanel"),beforeEnter:z},{path:"/profile",name:"UserProfile",component:a("UserProfile"),beforeEnter:w},{path:"/dashboard",name:"Dashboard",component:a("Dashboard"),beforeEnter:w},{path:"/login",name:"Login",component:a("Login"),beforeEnter:v},{path:"/register",name:"Register",component:a("Register"),beforeEnter:v}],M=W({history:D(),routes:K});q();const P=E(j);P.use(M);P.mount("#app");export{x as _,Q as a,Y as b,Z as c,d as g,y as i,k as l,X as r,U as s};
