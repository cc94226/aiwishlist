import{d as p,a as b,i as w,l as W,j as k}from"./wishService-BU8yXoRe.js";import{_ as C,c as I,b as y}from"./index-Ca8b0D0Z.js";import{o as a,c as d,a as s,t as l,p as f,s as D,f as v,e as h,j as c,m as u,F as _,k as S,l as g,v as j,n as E}from"./vue-vendor-CyCdHuvd.js";import"./utils-BSVtTUhg.js";function F(i,t){return!i||!t?0:i===t?100:({å¼€å‘:["äº§å“","æµ‹è¯•"],è®¾è®¡:["äº§å“","è¿è¥"],äº§å“:["å¼€å‘","è®¾è®¡","è¿è¥"],è¿è¥:["äº§å“","è®¾è®¡"],è¡Œæ”¿:["äººäº‹","è´¢åŠ¡"],æµ‹è¯•:["å¼€å‘"]}[i]||[]).includes(t)?70:30}function x(i){return i>=90?{level:"é«˜åº¦åŒ¹é…",color:"#27ae60",icon:"â­â­â­"}:i>=70?{level:"ä¸­åº¦åŒ¹é…",color:"#f39c12",icon:"â­â­"}:i>=50?{level:"ä½åº¦åŒ¹é…",color:"#e67e22",icon:"â­"}:{level:"ä¸åŒ¹é…",color:"#95a5a6",icon:""}}function M(i){const t=JSON.parse(localStorage.getItem("currentUser")||"null");if(!t||!t.job)return null;const r=F(t.job,i.job),m=x(r);return{score:r,...m,userJob:t.job,wishJob:i.job}}const N={name:"WishDetail",data(){return{wish:null,newComment:"",isFavorited:!1,showEditDialog:!1,editingWish:null,matchInfo:null}},computed:{canEdit(){return this.wish&&y(this.wish)},canDelete(){return this.wish&&I(this.wish)}},watch:{"$route.params.id"(){this.loadWish(),this.loadFavoriteStatus(),this.loadMatchInfo()}},mounted(){this.loadWish(),this.loadFavoriteStatus(),this.loadMatchInfo()},methods:{loadWish(){const i=this.$route.params.id;this.wish=k(i),this.wish||this.$router.push("/")},loadFavoriteStatus(){const i=JSON.parse(localStorage.getItem("favorites")||"[]");this.isFavorited=i.includes(parseInt(this.$route.params.id))},loadMatchInfo(){this.wish&&(this.matchInfo=M(this.wish))},goBack(){this.$router.back()},likeWish(){const i=W(this.wish.id);i&&(this.wish=i)},toggleFavorite(){const i=JSON.parse(localStorage.getItem("favorites")||"[]"),t=parseInt(this.$route.params.id);if(this.isFavorited){const r=i.indexOf(t);r>-1&&i.splice(r,1)}else i.push(t);localStorage.setItem("favorites",JSON.stringify(i)),this.isFavorited=!this.isFavorited},addComment(){if(!this.newComment.trim())return;const i=w(this.wish.id,this.newComment);i&&(this.wish=i,this.newComment="")},formatDate(i){return new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getJobClass(i){return{å¼€å‘:"job-dev",è®¾è®¡:"job-design",è¡Œæ”¿:"job-admin"}[i]||""},editWish(){this.wish&&(this.editingWish={...this.wish},this.showEditDialog=!0)},closeEditDialog(){this.showEditDialog=!1,this.editingWish=null},saveEdit(){if(this.editingWish){const i=b(this.editingWish.id,{title:this.editingWish.title,description:this.editingWish.description,job:this.editingWish.job});i&&(this.wish=i,this.loadMatchInfo(),this.closeEditDialog(),alert("æ„¿æœ›æ›´æ–°æˆåŠŸï¼"))}},deleteWish(){confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ„¿æœ›å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼")&&p(this.wish.id)&&(alert("æ„¿æœ›å·²åˆ é™¤"),this.$router.push("/"))}}},J={class:"wish-detail"},V={key:0,class:"detail-card"},B={class:"detail-header"},O={class:"header-content"},U={class:"detail-body"},q={key:0,class:"match-analysis"},z={class:"match-content"},A={class:"match-score"},L={class:"match-icon"},T={class:"match-percentage"},G={class:"match-details"},H={class:"wish-info"},K={class:"info-item"},P={class:"value"},Q={class:"info-item"},R={class:"value"},X={class:"wish-description"},Y={class:"wish-actions"},Z={class:"comments-section"},$={class:"comment-form"},tt=["disabled"],st={class:"comments-list"},it={class:"comment-header"},et={class:"comment-author"},ot={class:"comment-date"},nt={class:"comment-content"},lt={key:0,class:"no-comments"},at={key:1,class:"loading"},dt={class:"form-group"},rt={class:"form-group"},ht={class:"form-group"},ct={class:"form-actions"};function mt(i,t,r,m,e,n){return a(),d("div",J,[e.wish?(a(),d("div",V,[s("div",B,[s("button",{class:"back-btn",onClick:t[0]||(t[0]=(...o)=>n.goBack&&n.goBack(...o))},"â† è¿”å›"),s("div",O,[s("h1",null,l(e.wish.title),1),s("span",{class:f(["job-badge",n.getJobClass(e.wish.job)])},l(e.wish.job),3)])]),s("div",U,[e.matchInfo?(a(),d("div",q,[t[16]||(t[16]=s("h3",null,"å²—ä½åŒ¹é…åˆ†æ",-1)),s("div",z,[s("div",A,[s("span",L,l(e.matchInfo.icon),1),s("span",{class:"match-level",style:D({color:e.matchInfo.color})},l(e.matchInfo.level),5),s("span",T,"åŒ¹é…åº¦ï¼š"+l(e.matchInfo.score)+"%",1)]),s("div",G,[s("p",null,[t[14]||(t[14]=v(" æ‚¨çš„å²—ä½ï¼š",-1)),s("strong",null,l(e.matchInfo.userJob),1)]),s("p",null,[t[15]||(t[15]=v(" æ„¿æœ›å²—ä½ï¼š",-1)),s("strong",null,l(e.matchInfo.wishJob),1)])])])])):h("",!0),s("div",H,[s("div",K,[t[17]||(t[17]=s("span",{class:"label"},"æäº¤è€…ï¼š",-1)),s("span",P,l(e.wish.submitter),1)]),s("div",Q,[t[18]||(t[18]=s("span",{class:"label"},"æäº¤æ—¶é—´ï¼š",-1)),s("span",R,l(n.formatDate(e.wish.createdAt)),1)])]),s("div",X,[t[19]||(t[19]=s("h3",null,"éœ€æ±‚æè¿°",-1)),s("p",null,l(e.wish.description),1)]),s("div",Y,[s("button",{class:"action-btn like-btn",onClick:t[1]||(t[1]=(...o)=>n.likeWish&&n.likeWish(...o))},"ğŸ‘ ç‚¹èµ ("+l(e.wish.likes)+")",1),s("button",{class:f(["action-btn favorite-btn",{active:e.isFavorited}]),onClick:t[2]||(t[2]=(...o)=>n.toggleFavorite&&n.toggleFavorite(...o))}," â­ "+l(e.isFavorited?"å·²æ”¶è—":"æ”¶è—"),3),n.canEdit?(a(),d("button",{key:0,class:"action-btn edit-btn",onClick:t[3]||(t[3]=(...o)=>n.editWish&&n.editWish(...o))},"âœï¸ ç¼–è¾‘")):h("",!0),n.canDelete?(a(),d("button",{key:1,class:"action-btn delete-btn",onClick:t[4]||(t[4]=(...o)=>n.deleteWish&&n.deleteWish(...o))}," ğŸ—‘ï¸ åˆ é™¤ ")):h("",!0)]),s("div",Z,[s("h3",null,"è¯„è®º ("+l(e.wish.comments.length)+")",1),s("div",$,[c(s("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>e.newComment=o),placeholder:"å†™ä¸‹ä½ çš„è¯„è®º...",rows:"3",class:"comment-input"},null,512),[[u,e.newComment]]),s("button",{class:"comment-submit-btn",disabled:!e.newComment.trim(),onClick:t[6]||(t[6]=(...o)=>n.addComment&&n.addComment(...o))}," å‘è¡¨è¯„è®º ",8,tt)]),s("div",st,[(a(!0),d(_,null,S(e.wish.comments,o=>(a(),d("div",{key:o.id,class:"comment-item"},[s("div",it,[s("span",et,l(o.author),1),s("span",ot,l(n.formatDate(o.createdAt)),1)]),s("p",nt,l(o.content),1)]))),128)),e.wish.comments.length===0?(a(),d("div",lt," æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼ ")):h("",!0)])])])])):(a(),d("div",at,[...t[20]||(t[20]=[s("p",null,"åŠ è½½ä¸­...",-1)])])),e.showEditDialog?(a(),d("div",{key:2,class:"modal-overlay",onClick:t[13]||(t[13]=(...o)=>n.closeEditDialog&&n.closeEditDialog(...o))},[s("div",{class:"modal-content",onClick:t[12]||(t[12]=g(()=>{},["stop"]))},[t[26]||(t[26]=s("h3",null,"ç¼–è¾‘æ„¿æœ›",-1)),s("form",{onSubmit:t[11]||(t[11]=g((...o)=>n.saveEdit&&n.saveEdit(...o),["prevent"]))},[s("div",dt,[t[21]||(t[21]=s("label",null,"æ„¿æœ›åç§°ï¼š",-1)),c(s("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>e.editingWish.title=o),required:"",class:"form-input"},null,512),[[u,e.editingWish.title]])]),s("div",rt,[t[22]||(t[22]=s("label",null,"éœ€æ±‚æè¿°ï¼š",-1)),c(s("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>e.editingWish.description=o),required:"",rows:"4",class:"form-textarea"},null,512),[[u,e.editingWish.description]])]),s("div",ht,[t[24]||(t[24]=s("label",null,"èŒä¸šï¼š",-1)),c(s("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>e.editingWish.job=o),required:"",class:"form-select"},[...t[23]||(t[23]=[E('<option value="å¼€å‘" data-v-7553a2af>å¼€å‘</option><option value="è®¾è®¡" data-v-7553a2af>è®¾è®¡</option><option value="è¡Œæ”¿" data-v-7553a2af>è¡Œæ”¿</option><option value="äº§å“" data-v-7553a2af>äº§å“</option><option value="è¿è¥" data-v-7553a2af>è¿è¥</option><option value="å…¶ä»–" data-v-7553a2af>å…¶ä»–</option>',6)])],512),[[j,e.editingWish.job]])]),s("div",ct,[t[25]||(t[25]=s("button",{type:"submit",class:"btn btn-primary"},"ä¿å­˜",-1)),s("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=(...o)=>n.closeEditDialog&&n.closeEditDialog(...o))},"å–æ¶ˆ")])],32)])])):h("",!0)])}const pt=C(N,[["render",mt],["__scopeId","data-v-7553a2af"]]);export{pt as default};
