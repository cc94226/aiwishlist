import{c as E,a,t as _,b as N,r as H,o as h,d as u,w as c,e as C,F as D,f as y,g as m,h as V,i as K,j}from"./vue-vendor-BrtzZnCP.js";import{l as d}from"./utils-B2RonjJ0.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();function U(){const r=localStorage.getItem("users");return r?JSON.parse(r):[]}function A(r){localStorage.setItem("users",JSON.stringify(r))}function p(){const r=localStorage.getItem("currentUser");return r?JSON.parse(r):null}function I(r){localStorage.setItem("currentUser",JSON.stringify(r))}function x(){localStorage.removeItem("currentUser")}function me(r,e){const n=U().find(o=>o.email===r&&o.password===e);if(n){const{password:o,...s}=n;return I(s),{success:!0,user:s,message:"登录成功"}}return{success:!1,message:"邮箱或密码错误"}}function he(r,e,t,n){const o=U();if(o.some(O=>O.email===e))return{success:!1,message:"该邮箱已被注册",errors:["邮箱已存在"]};const s={id:`user-${Date.now()}`,name:r,email:e,password:t,role:"user",job:n||"",createdAt:new Date().toISOString()};o.push(s),A(o);const{password:i,...R}=s;return I(R),{success:!0,user:R,message:"注册成功"}}function b(){const r=p();return r&&r.role==="admin"}function v(r){const e=p();return e?r.submitter===e.name||r.submitterId===e.id:!1}function pe(r){return b()?!0:v(r)&&r.status==="draft"}function Ee(r){return b()?!0:v(r)&&r.status==="draft"}function B(){const r=U();if(!r.some(t=>t.email==="admin@example.com")){const t={id:"admin-001",name:"系统管理员",role:"admin",email:"admin@example.com",password:"admin123",job:"开发",createdAt:new Date().toISOString()};r.push(t),A(r)}if(!p()){const t=r.find(n=>n.email==="admin@example.com");if(t){const{password:n,...o}=t;I(o)}}}const W=(r,e)=>{const t=r.__vccOpts||r;for(const[n,o]of e)t[n]=o;return t},M={name:"ErrorBoundary",data(){return{hasError:!1,error:null,errorInfo:null,showDetails:!1}},computed:{errorMessage(){if(!this.error)return"发生未知错误";const r=this.error.name||"",e=this.error.message||"";return r==="ChunkLoadError"||e.includes("chunk")?"组件加载失败，请刷新页面重试":r==="NetworkError"||e.includes("network")||e.includes("fetch")?"网络连接失败，请检查网络设置":r==="TypeError"&&e.includes("undefined")?"数据加载异常，请刷新页面重试":r==="SyntaxError"?"代码解析错误，请联系管理员":e.includes("timeout")||e.includes("超时")?"请求超时，请稍后重试":e.includes("404")||e.includes("not found")?"请求的资源不存在":e.includes("401")||e.includes("unauthorized")?"未授权，请先登录":e.includes("403")||e.includes("forbidden")?"权限不足，无法执行此操作":e.includes("500")||e.includes("server error")?"服务器错误，请稍后重试":e&&e.length>0?e.length>100?e.substring(0,100)+"...":e:"发生错误，请稍后重试"},errorStack(){if(!this.error)return"";let r=this.error.stack||"";return this.errorInfo&&this.errorInfo.componentStack&&(r+=`

组件堆栈:
`+this.errorInfo.componentStack),r}},errorCaptured(r,e,t){return this.hasError=!0,this.error=r,this.errorInfo={componentStack:t,instance:e,timestamp:new Date().toISOString(),url:typeof window<"u"?window.location.href:"unknown",userAgent:typeof navigator<"u"?navigator.userAgent:"unknown"},console.error("ErrorBoundary捕获到错误:",{error:r,info:t,instance:e,url:window.location.href,timestamp:new Date().toISOString()}),this.reportError(r,t),!1},mounted(){window.addEventListener("error",this.handleGlobalError),window.addEventListener("unhandledrejection",this.handleUnhandledRejection)},beforeUnmount(){window.removeEventListener("error",this.handleGlobalError),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection)},methods:{handleRetry(){this.hasError=!1,this.error=null,this.errorInfo=null,this.showDetails=!1,this.$forceUpdate()},handleGoHome(){this.$router.push("/").catch(()=>{window.location.href="/"})},reportError(r,e){},toggleDetails(){this.showDetails=!this.showDetails},handleGlobalError(r){this.hasError||(this.hasError=!0,this.error=r.error||new Error(r.message||"未知错误"),this.errorInfo={filename:r.filename,lineno:r.lineno,colno:r.colno,timestamp:new Date().toISOString(),url:window.location.href},this.reportError(this.error,this.errorInfo))},handleUnhandledRejection(r){if(!this.hasError){this.hasError=!0;const e=r.reason instanceof Error?r.reason:new Error(String(r.reason||"Promise被拒绝"));this.error=e,this.errorInfo={type:"unhandledrejection",reason:r.reason,timestamp:new Date().toISOString(),url:window.location.href},this.reportError(e,this.errorInfo)}}}},F={key:0,class:"error-boundary"},G={class:"error-container"},q={class:"error-message"},$={class:"error-actions"},J={key:0,class:"error-details"},Q={class:"error-stack"};function z(r,e,t,n,o,s){return o.hasError?(h(),E("div",F,[a("div",G,[e[4]||(e[4]=a("div",{class:"error-icon"},"⚠️",-1)),e[5]||(e[5]=a("h2",{class:"error-title"},"出错了",-1)),a("p",q,_(s.errorMessage),1),a("div",$,[a("button",{class:"btn-retry",onClick:e[0]||(e[0]=(...i)=>s.handleRetry&&s.handleRetry(...i))},"重试"),a("button",{class:"btn-home",onClick:e[1]||(e[1]=(...i)=>s.handleGoHome&&s.handleGoHome(...i))},"返回首页")]),o.showDetails||r.process.env.NODE_ENV==="development"?(h(),E("details",J,[a("summary",{onClick:e[2]||(e[2]=(...i)=>s.toggleDetails&&s.toggleDetails(...i))},"错误详情"),a("pre",Q,_(s.errorStack),1)])):N("",!0),!o.showDetails&&r.process.env.NODE_ENV==="development"?(h(),E("button",{key:1,class:"btn-details",onClick:e[3]||(e[3]=(...i)=>s.toggleDetails&&s.toggleDetails(...i))}," 显示错误详情 ")):N("",!0)])])):H(r.$slots,"default",{key:1},void 0)}const X=W(M,[["render",z],["__scopeId","data-v-70ce146e"]]),Y={name:"App",components:{ErrorBoundary:X},data(){return{currentUser:null}},mounted(){this.loadUser(),this.$watch(()=>this.$route.path,()=>{this.loadUser()})},methods:{loadUser(){this.currentUser=p()},handleLogout(){x(),this.currentUser=null,this.$router.push("/")}}},Z={id:"app"},ee={class:"navbar"},re={class:"container"},te={class:"nav-links"},ne={class:"user-name"},oe={class:"main-content"};function se(r,e,t,n,o,s){const i=y("router-link"),R=y("router-view"),O=y("ErrorBoundary");return h(),E("div",Z,[a("nav",ee,[a("div",re,[e[8]||(e[8]=a("h1",{class:"logo"},"AI工具需求愿望收集平台",-1)),a("div",te,[u(i,{to:"/"},{default:c(()=>[...e[1]||(e[1]=[m("首页",-1)])]),_:1}),u(i,{to:"/submit"},{default:c(()=>[...e[2]||(e[2]=[m("提交愿望",-1)])]),_:1}),o.currentUser?(h(),C(i,{key:0,to:"/admin"},{default:c(()=>[...e[3]||(e[3]=[m("管理面板",-1)])]),_:1})):N("",!0),o.currentUser?(h(),E(D,{key:1},[u(i,{to:"/dashboard"},{default:c(()=>[...e[4]||(e[4]=[m("仪表板",-1)])]),_:1}),u(i,{to:"/profile"},{default:c(()=>[...e[5]||(e[5]=[m("用户信息",-1)])]),_:1}),a("span",ne,_(o.currentUser.name),1),a("button",{class:"btn-logout-nav",onClick:e[0]||(e[0]=(...P)=>s.handleLogout&&s.handleLogout(...P))},"退出")],64)):(h(),E(D,{key:2},[u(i,{to:"/login"},{default:c(()=>[...e[6]||(e[6]=[m("登录",-1)])]),_:1}),u(i,{to:"/register"},{default:c(()=>[...e[7]||(e[7]=[m("注册",-1)])]),_:1})],64))])])]),a("main",oe,[u(O,null,{default:c(()=>[u(R)]),_:1})])])}const ie=W(Y,[["render",se]]);function k(r,e,t){p()?t():t({name:"Login",query:{redirect:r.fullPath}})}function ae(r,e,t){if(!p()){t({name:"Login",query:{redirect:r.fullPath}});return}b()?t():t({name:"Home",query:{error:"unauthorized"}})}function L(r,e,t){p()?t({name:"Home"}):t()}const le=[{path:"/",name:"Home",component:d("Home")},{path:"/submit",name:"SubmitWish",component:d("SubmitWish")},{path:"/wish/:id",name:"WishDetail",component:d("WishDetail")},{path:"/admin",name:"AdminPanel",component:d("AdminPanel"),beforeEnter:ae},{path:"/profile",name:"UserProfile",component:d("UserProfile"),beforeEnter:k},{path:"/dashboard",name:"Dashboard",component:d("Dashboard"),beforeEnter:k},{path:"/login",name:"Login",component:d("Login"),beforeEnter:L},{path:"/register",name:"Register",component:d("Register"),beforeEnter:L}],T=V({history:K(),routes:le}),l={NETWORK_ERROR:"NETWORK_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",AUTH_ERROR:"AUTH_ERROR",PERMISSION_ERROR:"PERMISSION_ERROR",NOT_FOUND_ERROR:"NOT_FOUND_ERROR",SERVER_ERROR:"SERVER_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},S={[l.NETWORK_ERROR]:"网络连接失败，请检查网络设置",[l.VALIDATION_ERROR]:"数据验证失败，请检查输入",[l.AUTH_ERROR]:"未授权，请先登录",[l.PERMISSION_ERROR]:"权限不足，无法执行此操作",[l.NOT_FOUND_ERROR]:"请求的资源不存在",[l.SERVER_ERROR]:"服务器错误，请稍后重试",[l.UNKNOWN_ERROR]:"未知错误，请稍后重试"};class f extends Error{constructor(e,t=l.UNKNOWN_ERROR,n=null){super(e||S[t]),this.name="AppError",this.type=t,this.originalError=n,this.timestamp=new Date().toISOString()}static fromError(e){return e instanceof f?e:e instanceof TypeError?new f("类型错误",l.VALIDATION_ERROR,e):e instanceof ReferenceError?new f("引用错误",l.UNKNOWN_ERROR,e):e.message&&e.message.includes("network")?new f("网络错误",l.NETWORK_ERROR,e):new f(e.message||"未知错误",l.UNKNOWN_ERROR,e)}}class ue{constructor(){this.errorListeners=[],this.errorQueue=[],this.isReporting=!1}addListener(e){this.errorListeners.push(e)}removeListener(e){const t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}handleError(e,t={}){const n=f.fromError(e);return console.error("错误处理:",n,t),this.errorListeners.forEach(o=>{try{o(n,t)}catch(s){console.error("错误监听器执行失败:",s)}}),this.reportError(n,t),n}async reportError(e,t){if(this.isReporting){this.errorQueue.push({error:e,errorInfo:t});return}this.isReporting=!0;try{const n={message:e.message,type:e.type,stack:e.stack,timestamp:e.timestamp,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",url:typeof window<"u"?window.location.href:"unknown",...t};console.log("错误报告已发送:",n)}catch(n){console.error("发送错误报告失败:",n)}finally{if(this.isReporting=!1,this.errorQueue.length>0){const n=this.errorQueue.shift();this.reportError(n.error,n.errorInfo)}}}getFriendlyMessage(e){const t=f.fromError(e);return t.message||S[t.type]||S[l.UNKNOWN_ERROR]}}const g=new ue;function ce(r,e=null){r.config.errorHandler=(t,n,o)=>{var s;g.handleError(t,{type:"vue",component:((s=n==null?void 0:n.$options)==null?void 0:s.name)||"Unknown",info:o,url:window.location.href,timestamp:new Date().toISOString()})},r.config.warnHandler=(t,n,o)=>{},e&&e.onError(t=>{var n;if(console.error("路由错误:",t),t.name==="ChunkLoadError"||(n=t.message)!=null&&n.includes("chunk")){console.warn("代码块加载失败，尝试重新加载页面"),g.handleError(t,{type:"router",errorType:"ChunkLoadError",url:window.location.href}),setTimeout(()=>{window.location.reload()},2e3);return}g.handleError(t,{type:"router",url:window.location.href}),e.push("/").catch(()=>{console.error("路由跳转失败，使用window.location"),window.location.href="/"})}),window.addEventListener("error",t=>{g.handleError(t.error||new Error(t.message),{type:"global",filename:t.filename,lineno:t.lineno,colno:t.colno,url:window.location.href,timestamp:new Date().toISOString()})}),window.addEventListener("unhandledrejection",t=>{const n=t.reason instanceof Error?t.reason:new Error(String(t.reason||"未处理的Promise拒绝"));g.handleError(n,{type:"unhandledrejection",reason:String(t.reason),url:window.location.href,timestamp:new Date().toISOString()})})}B();const w=j(ie);ce(w,T);w.config.warnHandler=(r,e,t)=>{};w.use(T);w.mount("#app");export{W as _,me as a,pe as b,Ee as c,p as g,b as i,x as l,he as r,I as s};
