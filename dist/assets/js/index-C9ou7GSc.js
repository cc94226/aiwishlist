import{c as R,a,t as N,b as y,r as T,o as h,d as u,w as c,e as H,F as D,f as w,g as f,h as V,i as C,j as K}from"./vue-vendor-BrtzZnCP.js";import{l as d}from"./utils-BcjtJagn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function U(){const r=localStorage.getItem("users");return r?JSON.parse(r):[]}function v(r){localStorage.setItem("users",JSON.stringify(r))}function p(){const r=localStorage.getItem("currentUser");return r?JSON.parse(r):null}function b(r){localStorage.setItem("currentUser",JSON.stringify(r))}function j(){localStorage.removeItem("currentUser")}function fe(r,e){const o=U().find(s=>s.email===r&&s.password===e);if(o){const{password:s,...n}=o;return b(n),{success:!0,user:n,message:"登录成功"}}return{success:!1,message:"邮箱或密码错误"}}function he(r,e,t,o){const s=U();if(s.some(O=>O.email===e))return{success:!1,message:"该邮箱已被注册",errors:["邮箱已存在"]};const n={id:`user-${Date.now()}`,name:r,email:e,password:t,role:"user",job:o||"",createdAt:new Date().toISOString()};s.push(n),v(s);const{password:i,...E}=n;return b(E),{success:!0,user:E,message:"注册成功"}}function I(){const r=p();return r&&r.role==="admin"}function A(r){const e=p();return e?r.submitter===e.name||r.submitterId===e.id:!1}function pe(r){return I()?!0:A(r)&&r.status==="draft"}function Re(r){return I()?!0:A(r)&&r.status==="draft"}function x(){const r=U();if(!r.some(t=>t.email==="admin@example.com")){const t={id:"admin-001",name:"系统管理员",role:"admin",email:"admin@example.com",password:"admin123",job:"开发",createdAt:new Date().toISOString()};r.push(t),v(r)}if(!p()){const t=r.find(o=>o.email==="admin@example.com");if(t){const{password:o,...s}=t;b(s)}}}const W=(r,e)=>{const t=r.__vccOpts||r;for(const[o,s]of e)t[o]=s;return t},B={name:"ErrorBoundary",data(){return{hasError:!1,error:null,errorInfo:null,showDetails:!1}},computed:{errorMessage(){if(!this.error)return"发生未知错误";const r=this.error.name||"",e=this.error.message||"";return r==="ChunkLoadError"||e.includes("chunk")?"组件加载失败，请刷新页面重试":r==="NetworkError"||e.includes("network")||e.includes("fetch")?"网络连接失败，请检查网络设置":r==="TypeError"&&e.includes("undefined")?"数据加载异常，请刷新页面重试":r==="SyntaxError"?"代码解析错误，请联系管理员":e.includes("timeout")||e.includes("超时")?"请求超时，请稍后重试":e.includes("404")||e.includes("not found")?"请求的资源不存在":e.includes("401")||e.includes("unauthorized")?"未授权，请先登录":e.includes("403")||e.includes("forbidden")?"权限不足，无法执行此操作":e.includes("500")||e.includes("server error")?"服务器错误，请稍后重试":e&&e.length>0?e.length>100?e.substring(0,100)+"...":e:"发生错误，请稍后重试"},errorStack(){if(!this.error)return"";let r=this.error.stack||"";return this.errorInfo&&this.errorInfo.componentStack&&(r+=`

组件堆栈:
`+this.errorInfo.componentStack),r}},errorCaptured(r,e,t){return this.hasError=!0,this.error=r,this.errorInfo={componentStack:t,instance:e,timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent},console.error("ErrorBoundary捕获到错误:",{error:r,info:t,instance:e,url:window.location.href,timestamp:new Date().toISOString()}),this.reportError(r,t),!1},mounted(){window.addEventListener("error",this.handleGlobalError),window.addEventListener("unhandledrejection",this.handleUnhandledRejection)},beforeUnmount(){window.removeEventListener("error",this.handleGlobalError),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection)},methods:{handleRetry(){this.hasError=!1,this.error=null,this.errorInfo=null,this.showDetails=!1,this.$forceUpdate()},handleGoHome(){this.$router.push("/").catch(()=>{window.location.href="/"})},reportError(r,e){},toggleDetails(){this.showDetails=!this.showDetails},handleGlobalError(r){this.hasError||(this.hasError=!0,this.error=r.error||new Error(r.message||"未知错误"),this.errorInfo={filename:r.filename,lineno:r.lineno,colno:r.colno,timestamp:new Date().toISOString(),url:window.location.href},this.reportError(this.error,this.errorInfo))},handleUnhandledRejection(r){if(!this.hasError){this.hasError=!0;const e=r.reason instanceof Error?r.reason:new Error(String(r.reason||"Promise被拒绝"));this.error=e,this.errorInfo={type:"unhandledrejection",reason:r.reason,timestamp:new Date().toISOString(),url:window.location.href},this.reportError(e,this.errorInfo)}}}},M={key:0,class:"error-boundary"},F={class:"error-container"},G={class:"error-message"},q={class:"error-actions"},$={key:0,class:"error-details"},J={class:"error-stack"};function Q(r,e,t,o,s,n){return s.hasError?(h(),R("div",M,[a("div",F,[e[4]||(e[4]=a("div",{class:"error-icon"},"⚠️",-1)),e[5]||(e[5]=a("h2",{class:"error-title"},"出错了",-1)),a("p",G,N(n.errorMessage),1),a("div",q,[a("button",{class:"btn-retry",onClick:e[0]||(e[0]=(...i)=>n.handleRetry&&n.handleRetry(...i))},"重试"),a("button",{class:"btn-home",onClick:e[1]||(e[1]=(...i)=>n.handleGoHome&&n.handleGoHome(...i))},"返回首页")]),s.showDetails||r.process.env.NODE_ENV==="development"?(h(),R("details",$,[a("summary",{onClick:e[2]||(e[2]=(...i)=>n.toggleDetails&&n.toggleDetails(...i))},"错误详情"),a("pre",J,N(n.errorStack),1)])):y("",!0),!s.showDetails&&r.process.env.NODE_ENV==="development"?(h(),R("button",{key:1,class:"btn-details",onClick:e[3]||(e[3]=(...i)=>n.toggleDetails&&n.toggleDetails(...i))}," 显示错误详情 ")):y("",!0)])])):T(r.$slots,"default",{key:1},void 0)}const z=W(B,[["render",Q],["__scopeId","data-v-25f63992"]]),X={name:"App",components:{ErrorBoundary:z},data(){return{currentUser:null}},mounted(){this.loadUser(),this.$watch(()=>this.$route.path,()=>{this.loadUser()})},methods:{loadUser(){this.currentUser=p()},handleLogout(){j(),this.currentUser=null,this.$router.push("/")}}},Y={id:"app"},Z={class:"navbar"},ee={class:"container"},re={class:"nav-links"},te={class:"user-name"},se={class:"main-content"};function oe(r,e,t,o,s,n){const i=w("router-link"),E=w("router-view"),O=w("ErrorBoundary");return h(),R("div",Y,[a("nav",Z,[a("div",ee,[e[8]||(e[8]=a("h1",{class:"logo"},"AI工具需求愿望收集平台",-1)),a("div",re,[u(i,{to:"/"},{default:c(()=>[...e[1]||(e[1]=[f("首页",-1)])]),_:1}),u(i,{to:"/submit"},{default:c(()=>[...e[2]||(e[2]=[f("提交愿望",-1)])]),_:1}),s.currentUser?(h(),H(i,{key:0,to:"/admin"},{default:c(()=>[...e[3]||(e[3]=[f("管理面板",-1)])]),_:1})):y("",!0),s.currentUser?(h(),R(D,{key:1},[u(i,{to:"/dashboard"},{default:c(()=>[...e[4]||(e[4]=[f("仪表板",-1)])]),_:1}),u(i,{to:"/profile"},{default:c(()=>[...e[5]||(e[5]=[f("用户信息",-1)])]),_:1}),a("span",te,N(s.currentUser.name),1),a("button",{class:"btn-logout-nav",onClick:e[0]||(e[0]=(...P)=>n.handleLogout&&n.handleLogout(...P))},"退出")],64)):(h(),R(D,{key:2},[u(i,{to:"/login"},{default:c(()=>[...e[6]||(e[6]=[f("登录",-1)])]),_:1}),u(i,{to:"/register"},{default:c(()=>[...e[7]||(e[7]=[f("注册",-1)])]),_:1})],64))])])]),a("main",se,[u(O,null,{default:c(()=>[u(E)]),_:1})])])}const ne=W(X,[["render",oe]]);function k(r,e,t){p()?t():t({name:"Login",query:{redirect:r.fullPath}})}function ie(r,e,t){if(!p()){t({name:"Login",query:{redirect:r.fullPath}});return}I()?t():t({name:"Home",query:{error:"unauthorized"}})}function L(r,e,t){p()?t({name:"Home"}):t()}const ae=[{path:"/",name:"Home",component:d("Home")},{path:"/submit",name:"SubmitWish",component:d("SubmitWish")},{path:"/wish/:id",name:"WishDetail",component:d("WishDetail")},{path:"/admin",name:"AdminPanel",component:d("AdminPanel"),beforeEnter:ie},{path:"/profile",name:"UserProfile",component:d("UserProfile"),beforeEnter:k},{path:"/dashboard",name:"Dashboard",component:d("Dashboard"),beforeEnter:k},{path:"/login",name:"Login",component:d("Login"),beforeEnter:L},{path:"/register",name:"Register",component:d("Register"),beforeEnter:L}],le=V({history:C(),routes:ae}),l={NETWORK_ERROR:"NETWORK_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",AUTH_ERROR:"AUTH_ERROR",PERMISSION_ERROR:"PERMISSION_ERROR",NOT_FOUND_ERROR:"NOT_FOUND_ERROR",SERVER_ERROR:"SERVER_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},S={[l.NETWORK_ERROR]:"网络连接失败，请检查网络设置",[l.VALIDATION_ERROR]:"数据验证失败，请检查输入",[l.AUTH_ERROR]:"未授权，请先登录",[l.PERMISSION_ERROR]:"权限不足，无法执行此操作",[l.NOT_FOUND_ERROR]:"请求的资源不存在",[l.SERVER_ERROR]:"服务器错误，请稍后重试",[l.UNKNOWN_ERROR]:"未知错误，请稍后重试"};class m extends Error{constructor(e,t=l.UNKNOWN_ERROR,o=null){super(e||S[t]),this.name="AppError",this.type=t,this.originalError=o,this.timestamp=new Date().toISOString()}static fromError(e){return e instanceof m?e:e instanceof TypeError?new m("类型错误",l.VALIDATION_ERROR,e):e instanceof ReferenceError?new m("引用错误",l.UNKNOWN_ERROR,e):e.message&&e.message.includes("network")?new m("网络错误",l.NETWORK_ERROR,e):new m(e.message||"未知错误",l.UNKNOWN_ERROR,e)}}class ue{constructor(){this.errorListeners=[],this.errorQueue=[],this.isReporting=!1}addListener(e){this.errorListeners.push(e)}removeListener(e){const t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}handleError(e,t={}){const o=m.fromError(e);return console.error("错误处理:",o,t),this.errorListeners.forEach(s=>{try{s(o,t)}catch(n){console.error("错误监听器执行失败:",n)}}),this.reportError(o,t),o}async reportError(e,t){if(this.isReporting){this.errorQueue.push({error:e,errorInfo:t});return}this.isReporting=!0;try{const o={message:e.message,type:e.type,stack:e.stack,timestamp:e.timestamp,userAgent:navigator.userAgent,url:window.location.href,...t};console.log("错误报告已发送:",o)}catch(o){console.error("发送错误报告失败:",o)}finally{if(this.isReporting=!1,this.errorQueue.length>0){const o=this.errorQueue.shift();this.reportError(o.error,o.errorInfo)}}}getFriendlyMessage(e){const t=m.fromError(e);return t.message||S[t.type]||S[l.UNKNOWN_ERROR]}}const _=new ue;function ce(r){r.config.errorHandler=(e,t,o)=>{var s;_.handleError(e,{type:"vue",component:((s=t==null?void 0:t.$options)==null?void 0:s.name)||"Unknown",info:o})},window.addEventListener("error",e=>{_.handleError(e.error||new Error(e.message),{type:"global",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{_.handleError(e.reason||new Error("未处理的Promise拒绝"),{type:"unhandledrejection"}),e.preventDefault()})}x();const g=K(ne);ce(g);g.config.warnHandler=(r,e,t)=>{};g.use(le);g.mount("#app");export{W as _,fe as a,pe as b,Re as c,p as g,I as i,j as l,he as r,b as s};
