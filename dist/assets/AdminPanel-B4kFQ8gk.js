import{d as k,p as y,u as C,a as D,g as c}from"./wishService-BU8yXoRe.js";import{_ as E,r as A,o,c as d,a as s,t as u,b as U,w as V,d as x,e as a,v as p,F as w,f as B,g as h,h as v,i as g,j as S,l as F,k as M,m as j,n as N}from"./index-DT7EbbfQ.js";const T={name:"AdminPanel",data(){return{wishes:[],statusFilter:"all",sortBy:"newest",currentUser:null,showEditDialog:!1,editingWish:null}},computed:{isAdmin(){return j()},filteredWishes(){let l=[...this.wishes];return this.statusFilter!=="all"&&(l=l.filter(t=>t.status===this.statusFilter)),l.sort((t,r)=>this.sortBy==="newest"?new Date(r.createdAt)-new Date(t.createdAt):this.sortBy==="oldest"?new Date(t.createdAt)-new Date(r.createdAt):this.sortBy==="likes"?r.likes-t.likes:0),l}},mounted(){this.currentUser=M(),this.loadWishes()},methods:{loadWishes(){this.wishes=c()},filterWishes(){},editWish(l){const t=this.wishes.find(r=>r.id===l);t&&(this.editingWish={...t},this.showEditDialog=!0)},closeEditDialog(){this.showEditDialog=!1,this.editingWish=null},saveEdit(){this.editingWish&&D(this.editingWish.id,{title:this.editingWish.title,description:this.editingWish.description,job:this.editingWish.job,status:this.editingWish.status})&&(this.loadWishes(),this.closeEditDialog(),alert("愿望更新成功！"))},unpublishWish(l){confirm("确定要下架这个愿望吗？")&&C(l)&&(this.loadWishes(),alert("愿望已下架"))},publishWish(l){y(l)&&(this.loadWishes(),alert("愿望已发布"))},deleteWish(l){confirm("确定要删除这个愿望吗？此操作不可恢复！")&&k(l)&&(this.loadWishes(),alert("愿望已删除"))},formatDate(l){return new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})},getStatusText(l){return{published:"已发布",unpublished:"已下架",draft:"草稿"}[l]||l},getStatusClass(l){return{published:"status-published",unpublished:"status-unpublished",draft:"status-draft"}[l]||""},logout(){F(),this.$router.push("/")}}},q={class:"admin-panel"},z={class:"admin-header"},I={class:"user-info"},L={key:0,class:"no-permission"},P={key:1,class:"admin-content"},G={class:"filter-section"},H={class:"wishes-table"},J={class:"title-cell"},K={class:"actions-cell"},O=["onClick"],Q=["onClick"],R=["onClick"],X=["onClick"],Y={key:0,class:"empty-state"},Z={class:"form-group"},_={class:"form-group"},$={class:"form-group"},tt={class:"form-group"},st={class:"form-actions"};function et(l,t,r,it,n,i){var m,f;const W=A("router-link");return o(),d("div",q,[s("div",z,[t[13]||(t[13]=s("h2",null,"系统管理面板",-1)),s("div",I,[s("span",null,"当前用户："+u((m=n.currentUser)==null?void 0:m.name)+" ("+u(((f=n.currentUser)==null?void 0:f.role)==="admin"?"管理员":"普通用户")+")",1),s("button",{class:"logout-btn",onClick:t[0]||(t[0]=(...e)=>i.logout&&i.logout(...e))},"退出登录")])]),i.isAdmin?(o(),d("div",P,[s("div",G,[t[18]||(t[18]=s("label",null,"筛选状态：",-1)),a(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.statusFilter=e),onChange:t[2]||(t[2]=(...e)=>i.filterWishes&&i.filterWishes(...e))},[...t[16]||(t[16]=[s("option",{value:"all"},"全部",-1),s("option",{value:"published"},"已发布",-1),s("option",{value:"unpublished"},"已下架",-1),s("option",{value:"draft"},"草稿",-1)])],544),[[p,n.statusFilter]]),t[19]||(t[19]=s("label",{class:"sort-label"},"排序：",-1)),a(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.sortBy=e),onChange:t[4]||(t[4]=(...e)=>i.filterWishes&&i.filterWishes(...e))},[...t[17]||(t[17]=[s("option",{value:"newest"},"最新优先",-1),s("option",{value:"oldest"},"最旧优先",-1),s("option",{value:"likes"},"点赞数最多",-1)])],544),[[p,n.sortBy]])]),s("div",H,[s("table",null,[t[20]||(t[20]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"愿望名称"),s("th",null,"职业"),s("th",null,"提交者"),s("th",null,"点赞数"),s("th",null,"状态"),s("th",null,"提交时间"),s("th",null,"操作")])],-1)),s("tbody",null,[(o(!0),d(w,null,B(i.filteredWishes,e=>(o(),d("tr",{key:e.id},[s("td",null,u(e.id),1),s("td",J,u(e.title),1),s("td",null,u(e.job),1),s("td",null,u(e.submitter),1),s("td",null,u(e.likes),1),s("td",null,[s("span",{class:N(["status-badge",i.getStatusClass(e.status)])},u(i.getStatusText(e.status)),3)]),s("td",null,u(i.formatDate(e.createdAt)),1),s("td",K,[s("button",{class:"btn btn-edit",onClick:b=>i.editWish(e.id)},"编辑",8,O),e.status==="published"?(o(),d("button",{key:0,class:"btn btn-unpublish",onClick:b=>i.unpublishWish(e.id)}," 下架 ",8,Q)):h("",!0),e.status==="unpublished"?(o(),d("button",{key:1,class:"btn btn-publish",onClick:b=>i.publishWish(e.id)}," 发布 ",8,R)):h("",!0),s("button",{class:"btn btn-delete",onClick:b=>i.deleteWish(e.id)},"删除",8,X)])]))),128))])])]),i.filteredWishes.length===0?(o(),d("div",Y,[...t[21]||(t[21]=[s("p",null,"暂无愿望数据",-1)])])):h("",!0)])):(o(),d("div",L,[t[15]||(t[15]=s("p",null,"⚠️ 您没有管理员权限，无法访问此页面。",-1)),U(W,{to:"/",class:"link"},{default:V(()=>[...t[14]||(t[14]=[x("返回首页",-1)])]),_:1})])),n.showEditDialog?(o(),d("div",{key:2,class:"modal-overlay",onClick:t[12]||(t[12]=(...e)=>i.closeEditDialog&&i.closeEditDialog(...e))},[s("div",{class:"modal-content",onClick:t[11]||(t[11]=v(()=>{},["stop"]))},[t[29]||(t[29]=s("h3",null,"编辑愿望",-1)),s("form",{onSubmit:t[10]||(t[10]=v((...e)=>i.saveEdit&&i.saveEdit(...e),["prevent"]))},[s("div",Z,[t[22]||(t[22]=s("label",null,"愿望名称：",-1)),a(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.editingWish.title=e),required:"",class:"form-input"},null,512),[[g,n.editingWish.title]])]),s("div",_,[t[23]||(t[23]=s("label",null,"需求描述：",-1)),a(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.editingWish.description=e),required:"",rows:"4",class:"form-textarea"},null,512),[[g,n.editingWish.description]])]),s("div",$,[t[25]||(t[25]=s("label",null,"职业：",-1)),a(s("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.editingWish.job=e),required:"",class:"form-select"},[...t[24]||(t[24]=[S('<option value="开发" data-v-42603e0d>开发</option><option value="设计" data-v-42603e0d>设计</option><option value="行政" data-v-42603e0d>行政</option><option value="产品" data-v-42603e0d>产品</option><option value="运营" data-v-42603e0d>运营</option><option value="其他" data-v-42603e0d>其他</option>',6)])],512),[[p,n.editingWish.job]])]),s("div",tt,[t[27]||(t[27]=s("label",null,"状态：",-1)),a(s("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.editingWish.status=e),class:"form-select"},[...t[26]||(t[26]=[s("option",{value:"published"},"已发布",-1),s("option",{value:"unpublished"},"已下架",-1),s("option",{value:"draft"},"草稿",-1)])],512),[[p,n.editingWish.status]])]),s("div",st,[t[28]||(t[28]=s("button",{type:"submit",class:"btn btn-primary"},"保存",-1)),s("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=(...e)=>i.closeEditDialog&&i.closeEditDialog(...e))},"取消")])],32)])])):h("",!0)])}const ot=E(T,[["render",et],["__scopeId","data-v-42603e0d"]]);export{ot as default};
